<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Management - Discord Event Bot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">Discord Event Bot</div>
        <div class="nav-links">
            <a href="index.html">Events</a>
            <a href="presets.html">Presets</a>
            <a href="calendars.html" class="active">Calendars</a>
            <a href="settings.html">Settings</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="header-section">
            <h1>üìÖ Google Calendar Management</h1>
            <p>Configure Google Calendars to automatically sync events</p>
        </div>

        <div id="statusMessage" class="status-message" style="display: none;"></div>

        <!-- Google Calendar Status -->
        <div class="card">
            <h2>Configuration Status</h2>
            <div id="calendarStatus">
                <div class="loading">Checking configuration...</div>
            </div>
        </div>

        <!-- Add Calendar Section -->
        <div class="card">
            <h2>Add Calendar</h2>
            <div id="addCalendarSection">
                <div class="form-group">
                    <button onclick="loadAvailableCalendars()" class="btn btn-secondary">
                        üîç Browse My Google Calendars
                    </button>
                    <span style="margin: 0 10px;">or</span>
                    <button onclick="showManualAdd()" class="btn btn-secondary">
                        ‚úèÔ∏è Add Manually
                    </button>
                </div>

                <!-- Available Calendars (from Google) -->
                <div id="availableCalendarsSection" style="display: none; margin-top: 20px;">
                    <h3>Available Google Calendars</h3>
                    <div id="availableCalendarsList"></div>
                </div>

                <!-- Manual Add Form -->
                <div id="manualAddSection" style="display: none; margin-top: 20px;">
                    <h3>Add Calendar Manually</h3>
                    <div class="form-group">
                        <label for="calendarName">Calendar Name:</label>
                        <input type="text" id="calendarName" placeholder="e.g., Guild Events">
                    </div>
                    <div class="form-group">
                        <label for="calendarId">Calendar ID:</label>
                        <input type="text" id="calendarId" placeholder="e.g., abc123@group.calendar.google.com">
                        <small>Find this in Google Calendar settings ‚Üí Calendar ID</small>
                    </div>
                    <div class="form-group">
                        <button onclick="addCalendar()" class="btn btn-primary">Add Calendar</button>
                        <button onclick="hideManualAdd()" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configured Calendars List -->
        <div class="card">
            <h2>Configured Calendars</h2>
            <div id="configuredCalendarsList">
                <div class="loading">Loading calendars...</div>
            </div>
        </div>

        <!-- Setup Instructions -->
        <div class="card">
            <h2>üìö Setup Instructions</h2>
            <div class="instructions">
                <h3>Step 1: Create Google Cloud Project</h3>
                <ol>
                    <li>Go to <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                    <li>Create a new project or select existing one</li>
                    <li>Enable Google Calendar API</li>
                </ol>

                <h3>Step 2: Create Service Account</h3>
                <ol>
                    <li>Go to "IAM & Admin" ‚Üí "Service Accounts"</li>
                    <li>Create new service account</li>
                    <li>Grant "Editor" role</li>
                    <li>Create and download JSON key</li>
                </ol>

                <h3>Step 3: Share Calendar</h3>
                <ol>
                    <li>Open Google Calendar</li>
                    <li>Go to calendar settings</li>
                    <li>Share with service account email (from JSON key)</li>
                    <li>Grant "Make changes to events" permission</li>
                </ol>

                <h3>Step 4: Configure Bot</h3>
                <ol>
                    <li>Save JSON key as <code>data/calendar-credentials.json</code></li>
                    <li>Set <code>GOOGLE_CALENDAR_CREDENTIALS</code> in .env file</li>
                    <li>Restart the bot</li>
                </ol>
            </div>
        </div>
    </div>

    <script src="calendars.js"></script>
</body>
</html>